Procedia Computer
Science
ProcediaComputer
Computer Science
1–10
Procedia
Science001(2010)
(2012)
1587–1596

www.elsevier.com/locate/procedia

International Conference on Computational Science, ICCS 2010

Stochastic Models and Simulation of Ion Channel Dynamics
C.E. Dangerﬁelda,∗, D. Kaya , K. Burragea,b
a Oxford

University Computing Laboratory, Wolfson Building, Parks Road, Oxford, OX1 3QD, UK
of Mathematics, Queensland University of Technology, Brisbane, Queensland, Australia

b Department

Abstract
The behaviour of ion channels within cardiac and neuronal cells is intrinsically stochastic in nature. When the
number of channels is small this stochastic noise is large and can have an impact on the dynamics of the system
which is potentially an issue when modelling small neurons and drug block in cardiac cells. While exact methods
correctly capture the stochastic dynamics of a system they are computationally expensive, restricting their inclusion
into tissue level models and so approximations to exact methods are often used instead. The other issue in modelling
ion channel dynamics is that the transition rates are voltage dependent, adding a level of complexity as the channel
dynamics are coupled to the membrane potential. By assuming that such transition rates are constant over each time
step, it is possible to derive a stochastic diﬀerential equation (SDE), in the same manner as for biochemical reaction
networks, that describes the stochastic dynamics of ion channels. While such a model is more computationally
eﬃcient than exact methods we show that there are analytical problems with the resulting SDE as well as issues in
using current numerical schemes to solve such an equation. We therefore make two contributions: develop a diﬀerent
model to describe the stochastic ion channel dynamics that analytically behaves in the correct manner and also discuss
numerical methods that preserve the analytical properties of the model.
c 2012 Published by Elsevier Ltd. Open access under CC BY-NC-ND license.
⃝
Keywords:
Hodgkin-Huxley, Langevin equation, Wright-Fisher Model, boundary preserving, hybrid

1. Introduction
The electrical dynamics within neuronal and cardiac cells are important because the change in membrane potential
of such cells is the stimulus for neurons to ﬁre and the heart to beat. Understanding the dynamics of such systems is
therefore important in elucidating causes of fatal conditions such as cardiac arrhythmias. Modelling the cell membrane
as a capacitor in parallel with an ionic current, the change in the membrane potential over time can be described by a
simple ordinary diﬀerential equation (ODE)
1
dV
= − (Iion + I st ),
dt
Cm
∗ Corresponding

author
Email addresses: ciara.dangerfield@dtc.ox.ac.uk (C.E. Dangerﬁeld ), dkay@comlab.ox.ac.uk (D. Kay),
kevin.burrage@comlab.ox.ac.uk (K. Burrage)

c 2012 Published by Elsevier Ltd. Open access under CC BY-NC-ND license.
1877-0509 ⃝
doi:10.1016/j.procs.2010.04.178

(1)

1588

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

2

where Cm is the membrane capacitance, Iion is the total transmembrane ionic current and I st is the stimulus current.
Each ionic current is calculated using Ohm’s law. For example the ionic current, Ii , for ions of type i is given by
Ii = gi (V − Ei )

(2)

where V is the voltage, gi is the conductance and Ei is the equilibrium potential which can be found using the Nernst
equation [1]. The conductance is most simply described using a Hodgkin-Huxley formulation. Each ion channel is
modelled as a series of hypothetical gates where each gate is assumed to be either open, P, or closed, C, at time t,
see Figure 1. The gate transitions from the closed to the open and from the open to the closed position at rates a and
b respectively. Both transition rates are voltage dependent, adding a level of complexity as the ion channel dynamics
are coupled to the ﬂuctuating membrane potential of the cell.

Figure 1: Hodgkin-Huxley formulation of the ion channel dynamics of each gating variable. P is the open state, C is the closed state and a and b
are the voltage dependent transition rates.

In recent years more complicated formulations of ion channel dynamics called pseudo Markov, [2], have been used to
describe the conductance. The ion channel itself is assumed to be in one of n discrete states at time t and the transition
rates between states are again voltage dependent. Such models of ion channel dynamics have been used to gain insight
into the mechanisms of drug interaction with the heart, [3], [4].
Traditionally, ion channel dynamics have been described using deterministic models. However, as with many biological systems, heterogeneities at both cellular and tissue level introduces noise into the system. At the tissue level
the number of ion channels is not the same for all cells, while at the cellular level ion channel behaviour is intrinsically
stochastic. Incorporating the intrinsic stochastic nature of such systems into the mathematical models has been found
to be important in accurately reproducing irregular ﬁring behaviour of small neuronal cells [5] and potassium channel
block in cardiac cells [6]. When there are a very large number of channels this stochastic noise is small and has little
eﬀect, however as the number of channels becomes smaller stochastic noise has a greater impact on the dynamics of
the system. This is important in modelling small neurons where there are often very few ion channels, while in cardiac modelling the binding of a drug to an ion channel could reduce the number of active channels making stochastic
eﬀects more important.
The diﬃculty incorporating stochasticity into such systems is that the transition rates are not constant but voltage
dependent and therefore vary through time. Providing the discretisation time step used in the simulation is small, the
voltage can be assumed to remain frozen over each time step. This simpliﬁes the ion channel dynamics to a system,
as described by Figure 1 but where the transition rates (a and b) are constant, in that time step only. We note that such
systems described above are analogous to chemical reaction networks. Each state the channel can be in, for example
the open state, can be thought of as a chemical species and the transitions between states the chemical reactions.
Therefore the theory of biochemical reactions can be directly applied to this system to derive a stochastic model to
describe ion channel dynamics.
Consider an ion channel that can be in one of n states S 1 , . . . , S n and can transition from one state to another via
transitions T 1 , . . . , T m . Let Z(t) = (Z1 (t), . . . , Zn (t))T denote the state vector where Zi (t) is equal to the number of
ion channels in state S i at time t and let v j = (v j1 , . . . , v jn )T be the state change vector where v ji is deﬁned to be the
change in the number of channels in state i produced by one transition of type j. The relative chance of each transition
occurring if the system is in state z is given by the transition functions k1 (z), . . . , km (z). Since in a given channel there
is a series of transitions from one state to another the ki (z) are linear and we assume that ki (z) = ai z j , for some j,
where the ai are constant. If only one transition occurs in a given exponentially distributed time interval, the kinetics
are modelled by a discrete-state Markov process with a probability density that is the solution of a discrete partial
diﬀerential equation called the Master equation, [7]. This is the discrete analogue of the Fokker-Planck equation.
Individual trajectories of this process can be generated using the Stochastic Simulation Algorithm (SSA) [8]. This is

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

1589
3

a direct simulation method for a discrete-state Markov process in which the waiting time τ to the next transition is
sampled from an exponential distribution and the update takes the form x(t + τ) = x(t) + v j , where j is the most likely
transition to occur in that time interval. As the number of channels, N, increases this approach becomes computationally intensive. For example the number of sodium channels in a cardiac cell is estimated to be on the order of 10, 000,
[9], so this discrete state approach would be computationally expensive limiting the incorporation of cellular dynamics into higher level tissue models. If there exists a time interval such that the ion channel transitions through many
diﬀerent states many diﬀerent times, but the transition functions do not substantially change then the Master equation
can be approximated by a Langevin type stochastic diﬀerential equation (SDE), [10]. For ion channel dynamics the
transition functions are linear and due to the symmetry of the system the Langevin equation takes a special form.
Let υ be the matrix whose columns are the state change vectors, υ = (v1 , . . . , vm )T , and D be a diagonal matrix
with corresponding transition functions along the diagonal. Providing the conditions above hold, the dynamics of the
system can be approximately described by the Itˆo SDE [11]
d z = Σmj=1 k j (z)v j dt +

q
√1 Σ
b (z)dW j ,
N j=1 j

(3)

where N is the number of channels and b j (z) are the columns of the matrix, B(z), such that BBT = υD(z)υT . In
the equation above dW j are Wiener increments, N is the number of ion channels and q is the number of columns
of the matrix B. A Wiener process, W(t), is a stochastic process whose increment on the interval [t, t + h], deﬁned
by dW(t) = W(t + h) − W(t), satisfying the properties E(dW(t)) = 0, E(dW(t) − E(dW(t)))2 = h and where the
Wiener increments on non-overlapping intervals are independent. Thus a sample of a Wiener increment is just a
normal random variable with mean 0 and variance h. The Langevin equation, equation (3), for the Hodgkin-Huxley
formulation simpliﬁes to a single SDE
dy = (a − (a + b)y)dt +

√1
N

a + (b − a)ydW,

(4)

where y(t) = Z(t)/N is the proportion of channels that are open at time t.
The Langevin equation is constructed in such a way that its mean and variance matches the ﬁrst two moments of
the SSA computed from the corresponding Master equation. Thus the Langevin equation captures the stochastic nature of the system yet is more computationally eﬃcient than the Master equation when the number of channels is large.
For this reason the Langevin equation is usually used in favour of a discrete chain Markov approach for capturing the
intrinsic stochastic behaviour of ion channels in neuronal cells, [12] and cardiac cells [6]. However, as we shall see in
Section 2, the solution to equation (4) is such that a + (b − a)y ≥ 0 and so the solution lies outside the interval [0, 1].
This questions the biological relevance of such a model.
It is not just problems with the model itself, but also with the numerical methods used to simulate the trajectories
of SDEs that make biologically realistic solutions to the Langevin equation for ion channel dynamics diﬃcult to compute. The condition a + (b − a)y ≥ 0 ensures that solutions to equation (4) are real, even if they may not lie inside
[0, 1]. However, when the solution comes close to this boundary a Wiener increment can cause a + (b − a)y < 0 and
so solutions to equation (4) become imaginary. There are a number of ﬁxes that can be made in the numerical method
to ensure solutions remain real. For example, the absolute value under the square root in the noise term can be taken
or if the Wiener increment is too large then it is discarded and a new one is sampled, as in [12] and [6]. The problem
is that such ﬁxes can potentially introduce bias into the solution, [13].
In recent years numerical methods have been developed that aim to preserve boundaries of numerical solutions to
SDEs, [14], [15], [16]. Most techniques have focused on positivity preserving schemes applied to mean-reverting
square root processes in ﬁnancial models, [17], [18], [19], [20], [21]. The problem is that many such methods are
model dependent and so are not widely applicable [17], [19], or they only work under certain parameter regimes [14],
[16], [21].
The Langevin formulation outlined above therefore raises two issues. There is a problem with the model in that

1590

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

4

analytic solutions are not guaranteed to lie in [0, 1]. There are also complications with current numerical methods,
such as the Euler-Maruyama and Milstein methods, as they do not preserve the analytical properties of the underlying
model. In this paper we therefore make two contributions. Firstly we develop an alternative model to the Langevin
equation, based on the Wright-Fisher model, that ensures solutions remain within [0, 1]. Secondly we discuss two
numerical methods that ensure the numerical solution also remains within [0, 1], one based on a method developed by
Moro and Schurz [15] and the other a hybrid scheme that switches between a Langevin equation and SSA approach.
In the area of biochemical reaction networks there has been much development of hybrid methods that combine different stochastic model formulations for systems of chemical reactions in order to speed up computation time whilst
capturing the stochastic behaviour as accurately as possible, for a review see [22], [23], [24], [25]. However, such
methods have not previously been extensively used to simulate the dynamics of stochastic ion channel dynamics.
This paper focuses on the Langevin equation for the Hodgkin-Huxley formulation of the ion channel dynamics. From
here on in we refer to Langevin equation and Master equation as the Langevin equation and Master equation for the
Hodgkin-Huxley formulation, respectively. This paper is structured as follows. We begin in section 2 by showing
analytically that solutions to (4) can leave [0, 1]. In section 3 we discuss an alternative Langevin form for the simplest
formulation of ion channel dynamics (Hodgkin-Huxley) that analytically preserves the boundaries of 0 and 1. We
also discuss a new method for solving this equation, based on a method proposed by Moro and Schurz [15], that
ensures solutions remain within [0, 1] under certain parameter regimes. In section 4 we discuss a hybrid method for
this simple reaction. We show that when applied to the Hodgkin-Huxley model of a neuronal cell the hybrid method
ensures that solutions remain within the interval [0, 1] and is less computationally costly than using the SSA.
2. Issues with the Langevin equation
Consider the transformation
By Itˆo’s Lemma, [26], equation (4) becomes

u = a − (a + b)y.

(5)

√
du = (A + Bu)dt + C udW

(6)

√ . Equation (6), more commonly known as the CIR model, was ﬁrst
where A = 2ab, B = −(a + b) and C = (b−a)
N
proposed by Feller, [27], and later became popular when Cox, Ingersoll and Ross used it to model short-term interest
rates, [28]. Feller proved that there exists a nonnegative solution to (6) and that under certain parameter regimes the
solution is strictly positive.
−a
−a
, while if a > b then y ≤ b−a
. Therefore y
Consequently y satisﬁes the following boundaries: if a < b then y ≥ b−a
can leave [0, 1]. There is also an added complication when the a and b depend on voltage, as in the Hodgkin-Huxley
model, since then the boundaries are changing at each time step. Although solutions to the Langevin equation can
leave [0, 1], individual trajectories simulated by using the SSA do not. It is the ﬁrst two moments, not the individual
trajectories of the SSA that are mapped to determine the Langevin equation. This could result in solutions to the
Langevin equation violating the boundaries inherent in the Master equation. Therefore an alternative model with
similar ﬁrst two moments to the Langevin equation but whose solution remains within [0, 1] could provide a more
biologically realistic model for stochastic ion channel dynamics.

2.1. An Alternative Model
The Wright-Fisher model, described by the following Itˆo SDE, is used in population dynamics to model the frequency
of genes or alleles within a population [29],
dy = (A − (A + B)y)dt + C y(1 − y)dW.

(7)

It has been shown that solutions to equation (7) remain within the closed interval [0, 1] for all time (see for example
[30]). This is the characteristic we desire from the Langevin equation, (4), to ensure solutions are biologically realistic.

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

1591
5

The Langevin equation must also match the ﬁrst two moments of the underlying discrete-state Markov process. By
choosing A, B and C so that the mean and variance of (4) are close to (7), respectively, the new model, (7), provides
biologically realistic solutions whilst still providing a good continuous approximation to the discrete-state Markov
process. The mean solution of (4) and (7) both contain an exponential decaying term and a constant term. We
therefore want to ensure that the constant terms are the same and that the exponential terms decay at the same rate. To
meet the ﬁrst requirement A and B must be chosen such that A + B = Aa (a + b) while to meet the second we require
a + b − (A + B) = 0 which using the previous requirement means that (a + b)(1 − A/a) = 0. The equations for the
variance of (4) and (7) also contain a constant term and two exponentially decaying terms. Matching the constant
terms and exponential decay terms for the variance equations, along with the requirements from the means above,
2 A
2
2
(a + b) guarantees
then A B and C must be such that C 2 = N−1
a (a + b). Therefore taking A = a, B = b and C = N−1
that the mean of equations (4) and (7) are identical and the variances quickly become very close as t → ∞, as shown
in Figure 2. This choice of parameters also ensures that the solutions, solved along the same Brownian path, for the
two models are very similar, see Figure 2.

Figure 2: Left: the diﬀerence in the variance of the Langevin equation and the new model, equations (4) and (7). Right: mean diﬀerence between
the solution to (4) and the solution to (7) over 1000 simulations, solved using the Euler-Maruyama method where the absolute value was taken to
ensure solutions remained real. The parameter values used for all simulations are a = 1, b = 2 and N = 100. The initial condition was y0 = 0.5 and
the time step was h = 0.01

.
This model therefore provides an alternative model of Hodgkin-Huxley formulation for ion channel dynamics with
intrinsic noise which provides a very good approximation to the ﬁrst two moments of the Master equation whilst ensuring that solutions make sense biologically. However, although this alternative model analytically ensures solutions
remain within [0, 1], many current numerical methods are still inadequate at preserving such boundaries.
3. Improved numerical methods
Although there are methods that preserve the positivity of the CIR model, equation (6), [17], [15], incorporating such
methods into cardiac and neuronal cell models no longer guarantees real solutions to (4) due to the added complexity
that the transition rates, a and b are voltage dependent. The boundaries that are preserved by the numerical method
depend on the transition rates, which will now vary over time. Therefore at each time step there is eﬀectively a new
boundary and so the schemes may break down. For the Wright-Fisher model, the boundary does not depend on the
transition rates. Therefore providing the numerical scheme ensures solutions remain within [0, 1] for ﬁxed a and b
it should not break down when a and b are state dependent. Current widely used numerical schemes, such as the
Milstein method, are inadequate at ensuring solutions remain within [0, 1]. We therefore use the Moro and Schurz
method, [15]. The splitting step scheme they suggest exploits the structure of the SDE to try to ensure that the numerical scheme retains the natural boundaries of the system. The idea is to decompose the SDE into two equations,
an SDE and an ODE, where either the exact solution or conditional probability for the ﬁrst equation (the SDE) is
known. This solution is used as the initial condition in the second equation which is integrated using a deterministic

1592

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
6

C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

numerical algorithm. We propose a splitting that ensures solutions to equation (7) remain within [0, 1] for a wide
range of parameter values.
Equation (7) is split into an SDE and ODE as follows
dy¯ =

C 2 (1 − 2¯y)
dt + C y¯ (1 − y¯ )dW,
4

(8)

C2
C2
− A+B−
y dt.
4
2

(9)

dy = A −

Under this splitting scheme equation (8) is equivalent to the Stratonovich SDE dy¯ = C y¯ (1 − y¯ ) ◦ dW and so has
solution
2
C
y¯ (t + h) = sin ΔW + sin−1 y(t) ,
(10)
2
where h is the step size and ΔW is the Wiener increment which is sampled from a normal random variable with
variance equal to the step size h, [26]. This solution clearly remains between 0 and 1. Using (10) as the initial
condition in equation (9) the analytical solution is
y(t + h) =

C
A − C 2 /4
2
2
e−(A+B−C /2)h − 1 + e−(A+B−C /2)h sin ΔW + sin−1 y(t)
2
−A−B

C 2 /2

2

.

(11)

a
1
1
The update formula given by (11) remains within the interval [0, 1] providing a+b
∈ 2(N−1)
, 1 − 2(N−1)
. Thus this
splitting preserves the boundaries of 0 and 1 for a wide range of parameter values although it still breaks down when
a or b is very small. We leave the development of a numerical scheme for such parameter regimes that preserves the
boundaries of 0 and 1 to future work.

The Moro and Schurz scheme, described above, is compared with the Milstein method, [31], along the same Brownian
path. Two diﬀerent ﬁxes are incorporated into the Milstein method to ensure the solution remains within [0, 1]: ﬁrstly
the absolute value under the square root in the noise term is taken and secondly if the Wiener increment is too large
it is discarded and a new one is sampled. To allow for a fairer comparison the Milstein method has been used as it is
strong order one as with the Moro and Schurz approach.

Figure 3: Mean path diﬀerence over 100 simulations between solutions to equation (7) obtained using the Moro and Schurz method and the Milstein
method with the absolute value ﬁx (right) and the resampling the Wiener increment ﬁx (left). The parameter values are taken to be a = 0.009,
b = 1.7 and N = 100. The initial condition is taken to be 0.5 and the time step is h = 0.01.

The Milstein implementation utilises the ﬁx of taking the absolute value a maximum of 35 times, while the resampling
of the Wiener increment is employed a maximum of 24 times to ensure that solutions remain within [0, 1]. The Moro
and Schurz method therefore is a better representation of the true solution. When the Wiener increment is resampled

1593

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596

7

C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

the mean Milstein path is consistently greater than the mean Moro and Schurz solution, Figure 3. This suggests that
the eﬀect of resampling the Wiener increment is to overestimate the solution to equation (7). When the absolute value
is taken this seems to cause less bias than with resampling, Figure 3.
4. Hybrid Model
In the introduction two conditions were given that allowed the approximation of the SSA by the computationally
simpler Langevin equation, namely that there should exist a time step such that the transition functions do not substantially change while each channel transition must occur many times [10]. The Hodgkin-Huxley formulation of ion
channel dynamics when a and b are constant is analogous to a simple reversible isomerisation reaction. The validity
of the Langevin equation for such a system, equation (4), was studied by Gillespie [32]. It was shown that for this
simple system the ﬁrst and second conditions are satisﬁed providing
dt << (a + b)−1 ,

dt >>

1
1
1
max
,
,
N
a(1 − y) by

(12)

where dt is the time step. Therefore, for the approximation conditions to hold, the parameter regime must be such that
max

1
1
,
<< N(a + b)−1 .
a(1 − y) by

(13)

In Figure 4 these conditions are shown for the m gating variable (others similar) in the Hodgkin-Huxley model [33]
for the squid giant axon. Also shown are the probabilities that the Langevin equation, equation (4), lies outside of the
interval [0, 1] at equilibrium under the parameter regimes for the gating variables over a realistic range of voltages.
The Langevin form of the Hodgkin-Huxley model is given by equations (14) to (16).
1
dv
=
−G N m3 h(v − E N ) − G K n4 (v − E K ) − G L (v − E L ) + I ,
dt C
dm = (am (1 − m) − bm m)dt+ √1N

1

am (1 − m) + bm mdW1 ,

dn = (an (1 − n) − bn n)dt +
0.1(v + 40)
,
1 − exp(−(v + 40)/10)
1
,
bh =
1 + exp(−(v + 35)/10)
am =

√1
N2

dh = (ah (1 − h) − bh h)dt +

ah (1 − h) + bh hdW2 ,

an (1 − n) + bn ndW3 ,

bm = 0.108exp(−(v/18)),
an =

√1
N1

(14)

(15)

ah = 0.0027exp(−(v/20)),

0.01(v + 55)
,
1 − exp(−(v + 55)/10)

bn = 0.055exp(−(v/80)).

(16)

Figure 4: Left:conditions 1 and 2, from (12), calculated for the Hodgkin-Huxley model for each of the m gating parameter. The conditions are
shown with the varying voltage. The deterministic version of the Hodgkin-Huxley model was solved using ODE45 in Matlab over a time interval
of length 100. The initial condition is V(0) = −75, m(0) = 0.5, h(0) = 0.5, n(0) = 0.5. The parameter values used for simulation are E N = 50,
E K = −70, E L = −54, G N = 120, G L = 0.3, G K =36, C = 1 and I = 0. Right: the probability that the Langevin equation, equation (4), lies
outside of the interval [0, 1], calculated at equilibrium where a and b are the parameters from the Hodgkin-Huxley model calculated over a range
of voltages. The number of sodium and potassium channels is each 100.

1594

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

8

Here m and h are the gating variables for the sodium channel and n is the gating variable for the potassium channel,
while N1 and N2 are the numbers of channels of those channel types. It appears, from Figure 4, that parameter regimes
for which the probability of the solution to the Langevin equation leaving the interval [0, 1] is high corresponds to
situations where the condition (13) is violated. This suggests that the Langevin equation may not preserve the boundaries of 0 and 1 that are inherent in the Master equation as the approximation breaks down under certain parameter
regimes. In these regimes the mean lies very close to 0 or 1, so although the total number of channels may be high,
one of the channel states can become very small in number. Gillespie [10] states that for the approximation to the
Langevin equation to hold both channel state populations must be large. Under such conditions the only method to
accurately capture the dynamics of the system is to use a discrete-state Markov process simulated using the SSA. We
note that while there is still a positive probability that the solution to the Langevin equation can lie outside of [0, 1]
when the conditions are held, this probability is so small that it is negligible.
In neuronal and cardiac cell models, such as the Hodgkin-Huxley model, the cell spends the majority of time in
the resting state where the membrane potential is negative and the condition (13) is satisﬁed, Figure 4. However, as
the cell depolarises and reaches the top of the action potential (AP) the membrane potential increases sharply so that
nearly all the sodium channels open while nearly all the potassium channels close. The time in which the cell spends
at the height of the AP is small compared to that in which the cell is at rest, see Figure 5.

Figure 5: The deterministic Hodgkin-Huxley model, solved using ODE45 in Matlab under the same conditions as Figure 4.

We propose a hybrid scheme for the Hodgkin-Huxley model where stochasticity is incorporated into the gating variables that switches between a Langevin equation and SSA approach depending on whether the conditions given above
are met. Conditions 1 and 2, given by (12), are calculated for each gating variable at every time step. If the diﬀerence
between the conditions is greater than some prescribed threshold value for all gating variables then we assume that
the Langevin equation is a valid approximation, otherwise the SSA is used to simulate the dynamics of the underlying
discrete-state Markov process.
Table 1: Results for the hybrid solver of the stochastic Hodgkin-Huxley model

Method
Euler-Maruyama
Hybrid
SSA
Euler-Maruyama
Hybrid
SSA
Euler-Maruyama
Hybrid
SSA

No. of channels
100
100
100
1000
1000
1000
10000
10000
10000

Computing time
0.0306
0.4979
0.7118
0.0305
0.5045
2.7479
0.0330
0.6750
22.5255

No. simulations outside [0, 1]
4022
0
0
0
0
0
0
0
0

The computational time and the number of times the solution went outside the boundaries of 0 and 1 for the Langevin
form of the Hodgkin-Huxley model, equations (14) to (16), solved using the hybrid scheme the Euler-Maruyama

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

1595
9

method and the SSA are compared. We simulate noise in both the sodium and potassium channels, so each of the
three gating variables is described by a Langevin equation. To ensure the Euler-Maruyama method preserves the
boundaries of 0 and 1 the absolute value under the square root is taken. The results are summarised in Table 1. The
results shown are for 100000 simulations of the Hodgkin-Huxley model over a interval of length 100 and time step
0.01. The mean computing time in sec. is given in column three. The initial condition is V(0) = −75, m(0) = 0.5,
h(0) = 0.5, n(0) = 0.5 and the threshold value in the hybrid method is taken to be 0.15. Simulations were run on a
2.5GHz quad core Intel Core 2 processor.
As expected the hybrid scheme is more computationally intensive than the Euler-Maruyama method but is faster
than the SSA approach, Table 1. However, for intermediate values of N (N = 100) the hybrid scheme is still relatively
fast and, unlike the Euler-Maruyama method, ensures solutions remain within [0, 1] without the use of a ﬁx as is
needed in the Euler-Maruyama method, Table 1. As the number of channels becomes large (N = 10000) the hybrid
scheme increases in computationally intensity so that the beneﬁt of preserving the boundaries is outweighed by the
speed of computation, Table 1. At larger channel numbers the Euler-Maruyama method appears to be more eﬀective
than the hybrid method. There are two possible reasons for this. First for large values of N the noise term is small and
so trajectories are very close to the deterministic solution. Secondly, the threshold value was chosen in an ad hoc way,
i.e. a small value was chosen that preserved the boundaries of 0 and 1 in simulations. In future a method for choosing
a threshold parameter that is as small as possible whilst ensuring solutions remain within [0, 1] could help to improve
the speed of the hybrid scheme. Another possible reason is that the SSA approach was used for all variables if just
one of the gating variables did not satisfy the conditions. The speed of the hybrid scheme could thus be increased by
only using an SSA formulation for the gating variable that breaks the conditions, and a Langevin formulation for the
other variables. We expect both these elements to increase the speed, particularly for large numbers of channels.
5. Conclusion
In this paper we have discussed the modelling and numerical issues associated with ion channel dynamics within cardiac and neuronal cells. The solution to the Langevin equation for the simple open-closed model can go outside of the
biologically realistic boundaries of 0 and 1 and existing numerical methods fail to preserve boundary properties of the
solution. Therefore we developed a new model that is a variant of the Wright-Fisher model that preserves the mean
and approximates the variance of the original Langevin equation very closely and thus that of the underlying Master
equation whilst also ensuring that analytically solutions lie within [0, 1]. A new method for solving this improved
model was used to ensure solutions remained within [0, 1]. By comparison of this method with that of the Milstein
method we showed that certain ﬁxes can indeed bias the resulting solution and are therefore less than ideal. A hybrid
scheme, combining a Langevin equation and an SSA approach to solve the Langevin Hodgkin-Huxley model was
discussed in the ﬁnal section. While the computational time for the scheme is greater than for a Langevin equation
regime, since the time in which the SSA is utilised is short compared to that in which a Langevin equation formulation
is used for the Hodgkin-Huxley model, the increase in computational time is relatively small provided the number of
channels is not large. If the number of channels is large then the noise term is small and so trajectories of the Langevin
equation formulation are close to the deterministic solution. Therefore it may be that in such situations some method
for simulating the Langevin equation, such as the Euler Maruyama, is suﬃcient to capture the dynamics of the system.
Alternatively it may be that more work is needed to improve on the eﬃciency of the hybrid approach when there are
a large number of channels.
The analysis and methods described in this paper have been for the simple Hodgkin-Huxley formulation of ion channel dynamics in neuronal and cardiac cells. However, as discussed in the introduction, pseudo Markov formulation
is a more complex model to describe ion channel dynamics. Generalisation of the analysis and methods presented
here to multidimensional systems is therefore needed to understand the stochastic behaviour of these more complex
formulations of ion channel dynamics. In particular, such generalisations would allow the possibility for stochastic
eﬀects in drug block models in cardiac cells to be investigated.

1596

C.E. Dangerfield et al. / Procedia Computer Science 1 (2012) 1587–1596
C.E. Dangerﬁeld et al. / Procedia Computer Science 00 (2010) 1–10

10

6. Acknowledgements
The author C.E. Dangerﬁeld is funded by the Engineering and Physical Sciences Research Council via the Life
Sciences Interface doctoral training programme.
References
[1] Y. Rudy, J. R. Silva, Computational biology in the study of cardiac ion channels and cell electrophysiology, Quarterly Reviews of Biophysics
39 (01) (2006) 57–116. doi:10.1017/S0033583506004227.
[2] C. E. Clancy, Y. Rudy, Linking a genetic defect to its cellular phenotype in a cardiac arrhythmia, Nature 400 (6744) (1999) 566–569.
doi:10.1038/23034.
[3] D. J. Snyders, A. Chaudhary, High aﬃnity open channel block by dofetilide of HERG expressed in a human cell line, Mol Pharmacol 49 (6)
(1996) 949–955.
[4] C. E. Clancy, Z. I. Zhu, Y. Rudy, Pharmacogenetics and anti-arrhythmic drug therapy: a theoretical investigation, Am J Physiol Heart Circ
Physiol 292 (1) (2007) H66–75. doi:10.1152/ajpheart.00312.2006.
[5] A. Saarinen, M. Linne, O. Yliharja, Modeling single neuron behavior using stochastic diﬀerential equations, Neurocomputing 69 (2006)
1091–1096. doi:10.1016/j.neucom.2005.12.052.
[6] E. Pueyo, A. Corrias, K. Burrage, B. Rodriguez, From ion channel ﬂuctuations to the electrocardiogram. Implications for cardiac arrhythmogenesis, submitted (nd).
[7] D. Gillespie, A rigorous derivation of the chemical master equation, Physica A: Statistical Mechanics and its Applications 188 (1992) 404–
425. doi:10.1016/0378-4371(92)90283-V.
[8] D. T. Gillespie, Exact stochastic simulation of coupled chemical reactions, The Journal of Physical Chemistry 81 (25) (1977) 2340–2361.
doi:10.1021/j100540a008.
[9] T. Kiyosue, M. Arita, Late sodium current and its contribution to action potential conﬁguration in guinea pig ventricular myocytes, Circ Res
64 (2) (1989) 389–397.
[10] D. T. Gillespie, The chemical Langevin equation, The Journal of Chemical Physics 113 (1) (2000) 297–306. doi:10.1063/1.481811.
[11] B. Melykuti, K. Burrage, K. Zygalakis, Fast stochastic simulation of biochemical reaction systems by alternative formulations of the chemical
langevin equation, submitted (nd).
[12] R. F. Fox, Y. N. Lu, Emergent collective behavior in large numbers of globally coupled independently stochastic ion channels, Physical
Review E 49 (4) (1994) 3421–3431. doi:10.1103/PhysRevE.49.3421.
[13] R. Lord, R. Koekkoek, D. V. Dijk, A comparison of biased simulation schemes for stochastic volatility models, Quantitative Finance 10 (2)
(2010) 177–194. doi:10.1080/14697680802392496.
[14] W. Halley, S. J. A. Malham, A. Wiese, Positive and implicit stochastic volatility simulation, ArXiv e-printsarXiv:0802.4411.
[15] E. Moro, H. Schurz, Boundary Preserving Semianalytic Numerical Algorithms for Stochastic Diﬀerential Equations, SIAM Journal on
Scientiﬁc Computing 29 (4) (2007) 1525–1549.
[16] S. Ninomiya, N. Victoir, Weak approximation of stochastic diﬀerential equations and application to derivative pricingarXiv:math.PR/0605361.
[17] A. Alfonsi, High order discretization schemes for the CIR process: Application to aﬃne term structure and Heston models, Mathematics of
Computation 79 (2010) 209–237.
[18] C. Kahl, Positive numerical integration of stochastic diﬀerential equations, diploma thesis University of Wuppertal and ABN AMRO (2004).
[19] L. B. Andersen, Simple and eﬃcient simulation of the Heston stochastic volatility model, J. Comput. Finan. 11 (2008) 1–42.
[20] V. Mackeviˇcius, On weak approximations of CIR equation with high volatility, Mathematics and Computers in Simulation 80 (5) (2010)
959–970. doi:10.1016/j.matcom.2009.11.001.
[21] C. Kahl, P. J¨ackel, Fast strong approximation Monte Carlo schemes for stochastic volatility models, Quantitative Finance 6 (6) (2006) 513–
536. doi:10.1080/14697680600841108.
[22] J. Pahle, Biochemical simulations: stochastic, approximate stochastic and hybrid approaches, Brief Bioinform 10 (1) (2009) 53–64.
doi:10.1093/bib/bbn050.
[23] T. Henzinger, M. Mateescu, V. Wolf, Hyrid Numerical Solution of the Chemical Master Equation, submitted (nd).
[24] H. Salis, Y. Kaznessis, Accurate hybrid stochastic simulation of a system of coupled chemical or biochemical reactions, The Journal of
Chemical Physics 122 (5) (2005) 1–13.
[25] K. Burrage, T. Tian, P. Burrage, A multi-scaled approach for simulating chemical reaction systems, Progress in Biophysics and Molecular
Biology 85 (2-3) (2004) 217–234. doi:10.1016/j.pbiomolbio.2004.01.014.
[26] P. E. Kloeden, E. Platen, Numerical Solution of Stochastic Diﬀerential Equations (Stochastic Modelling and Applied Probability), corrected
Edition, Springer, 2010.
[27] W. Feller, Two Singular Diﬀusion Problems, The Annals of Mathematics 54 (1) (1951) 173–182. doi:10.2307/1969318.
[28] J. C. Cox, J. E. Ingersoll, S. A. Ross, A Theory of the Term Structure of Interest Rates, Econometrica 53 (2) (1985) 385–407.
doi:10.2307/1911242.
[29] W. J. Ewens, Mathematical Population Genetics, 2nd Edition, Springer, 2004.
[30] S. Karlin, H. M. Taylor, A Second Course in Stochastic Processes, Academic Press, 1981.
[31] S. M. Iacus, Simulation and Inference for Stochastic Diﬀerential Equations: With R Examples (Springer Series in Statistics), 1st Edition,
Springer, 2008.
[32] D. T. Gillespie, The Chemical Langevin and Fokker-Planck Equations for the Reversible Isomerization Reaction, The Journal of Physical
Chemistry A 106 (20) (2002) 5063–5071. doi:10.1021/jp0128832.
[33] A. L. Hodgkin, A. F. Huxley, A quantitative description of membrane current and its application to conduction and excitation in nerve, Journal
of Physiology 117 (1) (1952) 500–544. doi:10.1007/BF02459568.

